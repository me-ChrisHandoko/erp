# Environment
ENVIRONMENT=development

# Server Configuration
SERVER_HOST=0.0.0.0
SERVER_PORT=8080
SERVER_READ_TIMEOUT=30s
SERVER_WRITE_TIMEOUT=30s
SERVER_IDLE_TIMEOUT=120s

# Database Configuration (PostgreSQL only)
DATABASE_DRIVER=postgres
DATABASE_DSN=postgres://postgres:password@localhost:5432/erp_db?sslmode=disable

DATABASE_MAX_IDLE_CONNS=10
DATABASE_MAX_OPEN_CONNS=100
DATABASE_CONN_MAX_LIFETIME=1h

# JWT Configuration
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production
JWT_ALGORITHM=HS256
JWT_EXPIRY=30m
JWT_REFRESH_EXPIRY=720h
# For RS256 algorithm (recommended for production):
# JWT_ALGORITHM=RS256
# JWT_PRIVATE_KEY_PATH=./keys/private.pem
# JWT_PUBLIC_KEY_PATH=./keys/public.pem

# Argon2 Password Hashing
ARGON2_MEMORY=65536
ARGON2_ITERATIONS=3
ARGON2_PARALLELISM=4
ARGON2_SALT_LENGTH=16
ARGON2_KEY_LENGTH=32

# Security Configuration
SECURITY_MAX_LOGIN_ATTEMPTS=5
SECURITY_LOGIN_LOCKOUT_DURATION=15m

# 4-Tier Exponential Backoff Brute Force Protection
# Tier 1: 3-4 failed attempts → 5 minute lockout
SECURITY_LOCKOUT_TIER1_ATTEMPTS=3
SECURITY_LOCKOUT_TIER1_DURATION=5m
# Tier 2: 5-9 failed attempts → 15 minute lockout
SECURITY_LOCKOUT_TIER2_ATTEMPTS=5
SECURITY_LOCKOUT_TIER2_DURATION=15m
# Tier 3: 10-14 failed attempts → 1 hour lockout
SECURITY_LOCKOUT_TIER3_ATTEMPTS=10
SECURITY_LOCKOUT_TIER3_DURATION=1h
# Tier 4: 15+ failed attempts → 24 hour lockout
SECURITY_LOCKOUT_TIER4_ATTEMPTS=15
SECURITY_LOCKOUT_TIER4_DURATION=24h

# Security Headers Configuration (OWASP Secure Headers Project)
# Reference: https://owasp.org/www-project-secure-headers/

# Phase 1: Safe headers (no breaking changes - enable immediately)
SECURITY_ENABLE_X_FRAME_OPTIONS=true
SECURITY_ENABLE_X_CONTENT_TYPE=true
SECURITY_ENABLE_X_XSS_PROTECTION=true
SECURITY_ENABLE_REFERRER_POLICY=true
SECURITY_ENABLE_PERMISSIONS_POLICY=true

# Phase 2: HSTS (requires valid SSL certificate)
# ⚠️ WARNING: Enable ONLY after SSL is properly configured!
# Once enabled, users cannot access site via HTTP (forced HTTPS)
SECURITY_ENABLE_HSTS=false
SECURITY_HSTS_MAX_AGE=31536000                # 1 year in seconds
SECURITY_HSTS_INCLUDE_SUBDOMAINS=false        # Enable after subdomain SSL setup
SECURITY_HSTS_PRELOAD=false                    # Enable after submitting to browser preload list

# Phase 3: Content Security Policy (requires extensive testing)
# ⚠️ WARNING: Start with CSP_REPORT_ONLY=true to monitor violations first!
# Can break frontend if not configured correctly
SECURITY_ENABLE_CSP=false
SECURITY_CSP_REPORT_ONLY=true                  # Monitor violations before enforcing

# Cookie Configuration
COOKIE_SECURE=false
COOKIE_DOMAIN=localhost

# Tenant Configuration
DEFAULT_SUBSCRIPTION_PRICE=300000
TRIAL_PERIOD_DAYS=14
GRACE_PERIOD_DAYS=7

# Tenant Isolation Configuration (CRITICAL SECURITY)
# StrictMode: ERROR on queries without tenant context (REQUIRED in production)
# LogWarnings: Log all queries without tenant for debugging
# AllowBypass: Allow db.Set("bypass_tenant", true) for system/admin operations
TENANT_STRICT_MODE=true
TENANT_LOG_WARNINGS=true
TENANT_ALLOW_BYPASS=true

# Indonesian Tax Configuration
DEFAULT_PPN_RATE=11
DEFAULT_INVOICE_PREFIX=INV
DEFAULT_SO_PREFIX=SO
DEFAULT_PO_PREFIX=PO

# Logging Configuration
LOG_LEVEL=debug
LOG_FORMAT=json

# CORS Configuration
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:5173
CORS_ALLOWED_METHODS=GET,POST,PUT,PATCH,DELETE,OPTIONS
CORS_ALLOWED_HEADERS=Origin,Content-Type,Accept,Authorization

# Worker Configuration (Background Jobs)
WORKER_ENABLED=true
WORKER_SUBSCRIPTION_BILLING_CRON=0 0 * * *
WORKER_EXPIRY_MONITORING_CRON=0 6 * * *
WORKER_OUTSTANDING_CALC_CRON=0 1 * * *

# Email Configuration (SMTP)
# For Gmail: Enable 2FA and use App Password
# For Mailtrap (testing): Use Mailtrap credentials
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASSWORD=your-app-password
SMTP_FROM_NAME=ERP System
SMTP_FROM_EMAIL=noreply@erp.com
SMTP_TLS=true
EMAIL_VERIFICATION_EXPIRY=24h
PASSWORD_RESET_EXPIRY=1h

# File Upload Configuration
MAX_UPLOAD_SIZE=10485760
UPLOAD_PATH=./uploads

# Rate Limiting
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REQUESTS=100
RATE_LIMIT_WINDOW=1m

# Cache Configuration (Redis for rate limiting and caching)
CACHE_ENABLED=false
CACHE_REDIS_URL=localhost:6379
CACHE_DEFAULT_EXPIRATION=5m

# Background Job Configuration (Phase 4)
# Format: "second minute hour day month weekday" (cron format with seconds)
# Examples:
#   "0 0 * * * *"     - Every hour at minute 0
#   "0 */15 * * * *"  - Every 15 minutes
#   "0 0 2 * * *"     - Daily at 2:00 AM
# For testing: Use "*/1 * * * * *" for every second or "*/5 * * * * *" for every 5 seconds

JOB_ENABLE_CLEANUP=true
JOB_REFRESH_TOKEN_CLEANUP=0 0 * * * *     # Hourly at :00 - cleanup expired refresh tokens (30-day expiry)
JOB_EMAIL_CLEANUP=0 5 * * * *              # Hourly at :05 - cleanup expired/used email verifications (24hr expiry)
JOB_PASSWORD_CLEANUP=0 10 * * * *          # Hourly at :10 - cleanup expired/used password resets (1hr expiry)
JOB_LOGIN_CLEANUP=0 0 2 * * *              # Daily at 2 AM - cleanup old login attempts (7-day retention)
